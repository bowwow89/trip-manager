<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ì—¬í–‰ ê°€ì´ë“œ ë¹Œë” V7</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/lz-string/1.4.4/lz-string.min.js"></script>
<style>
    body { font-family: -apple-system, sans-serif; background: #f3f4f6; padding: 20px; padding-bottom: 120px; }
    .container { max-width: 900px; margin: 0 auto; }
    .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-bottom: 20px; }
    .input-field { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 6px; margin-bottom: 5px; }
    .btn { padding: 8px 16px; border-radius: 6px; font-weight: bold; cursor: pointer; border: none; color: white; transition: 0.2s; }
    .btn-blue { background: #3b82f6; }
    .btn-green { background: #10b981; width: 100%; padding: 15px; font-size: 1.1rem; box-shadow: 0 4px 10px rgba(16, 185, 129, 0.3); }
    .btn-red { background: #ef4444; font-size: 0.75rem; padding: 4px 8px; }
    .btn-gray { background: #6b7280; }
    .btn-yellow { background: #eab308; color: white; }
    
    .day-block { border: 1px solid #e5e7eb; border-radius: 8px; padding: 15px; margin-bottom: 20px; background: #fff; }
    
    .plan-tab { display: flex; gap: 5px; margin-bottom: 10px; border-bottom: 2px solid #f3f4f6; padding-bottom: 10px; }
    .tab-btn { flex: 1; padding: 8px; text-align: center; border-radius: 6px; cursor: pointer; font-weight: bold; color: #6b7280; background: #f9fafb; font-size: 0.9rem; }
    
    .tab-btn.active-common { background: #fef9c3; color: #854d0e; border: 1px solid #fde047; }
    .tab-btn.active-a { background: #eff6ff; color: #2563eb; border: 1px solid #bfdbfe; }
    .tab-btn.active-b { background: #fff1f2; color: #db2777; border: 1px solid #fecdd3; }
    .tab-btn.active-c { background: #ecfdf5; color: #059669; border: 1px solid #a7f3d0; }

    .event-item { background: #f9fafb; padding: 10px; border-radius: 8px; margin-bottom: 8px; border: 1px solid #eee; position: relative; }
    .event-item.plan-common { background: #fefce8; border-color: #fde047; }
    .event-item.plan-b { background: #fff1f2; border-color: #fecdd3; }
    .event-item.plan-c { background: #ecfdf5; border-color: #a7f3d0; }
    
    /* ì‹œê°„ ì„ íƒ ìŠ¤íƒ€ì¼ */
    .time-select-group { display: flex; align-items: center; gap: 2px; }
    .time-select { width: 48px; padding: 6px 2px; border: 1px solid #ddd; border-radius: 4px; text-align: center; }
</style>
</head>
<body>

<div class="container">
    <div class="flex justify-between items-center mb-6">
        <h1 class="text-2xl font-bold text-gray-800">ğŸ§³ ì—¬í–‰ ë¹Œë” V7</h1>
        <button onclick="saveWork()" class="btn btn-gray text-xs">ì„ì‹œ ì €ì¥</button>
    </div>

    <!-- 1. ê¸°ë³¸ ì„¤ì • -->
    <div class="card">
        <h2 class="text-xl font-bold mb-4">1. ê¸°ë³¸ ì„¤ì •</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
                <label class="font-bold text-sm text-gray-600">ì—¬í–‰ ì œëª©</label>
                <input type="text" id="appTitle" class="input-field" oninput="tripData.title=this.value" placeholder="ì˜ˆ: ì˜¤ì‚¬ì¹´ ë¨¹ë°© ì—¬í–‰">
            </div>
            <div>
                <label class="font-bold text-sm text-gray-600">í…Œë§ˆ ìƒ‰ìƒ</label>
                <select id="themeColor" class="input-field" onchange="tripData.theme=this.value">
                    <option value="blue">ë¸”ë£¨ (ê¸°ë³¸)</option>
                    <option value="pink">í•‘í¬ (ë²šê½ƒ)</option>
                    <option value="green">ê·¸ë¦° (ìì—°)</option>
                    <option value="purple">í¼í”Œ (ì•¼ê²½)</option>
                </select>
            </div>
        </div>

        <div class="mt-6 p-4 bg-gray-50 rounded-lg border border-gray-200">
            <div class="flex items-center gap-2 mb-3">
                <input type="checkbox" id="chkMultiPlan" class="w-5 h-5" onchange="toggleMultiPlan()">
                <label for="chkMultiPlan" class="font-bold text-gray-800 cursor-pointer select-none">ğŸ”„ ë©€í‹° í”Œëœ(A/B ì„ íƒ) ì‚¬ìš©í•˜ê¸°</label>
            </div>
            <div id="multiPlanInputs" class="grid grid-cols-3 gap-2" style="display:none;">
                <div><label class="text-xs text-blue-600 font-bold">Plan A</label><input type="text" id="planAName" class="input-field" placeholder="ì˜ˆ: ë ŒíŠ¸ì¹´" oninput="tripData.planA=this.value"></div>
                <div><label class="text-xs text-pink-600 font-bold">Plan B</label><input type="text" id="planBName" class="input-field" placeholder="ì˜ˆ: ëŒ€ì¤‘êµí†µ" oninput="tripData.planB=this.value"></div>
                <div><label class="text-xs text-green-600 font-bold">Plan C</label><input type="text" id="planCName" class="input-field" placeholder="ì˜ˆ: íƒì‹œíˆ¬ì–´" oninput="tripData.planC=this.value"></div>
            </div>
        </div>
    </div>

    <!-- 2. ì²´í¬ë¦¬ìŠ¤íŠ¸ -->
    <div class="card">
        <h2 class="text-xl font-bold mb-4">2. ì²´í¬ë¦¬ìŠ¤íŠ¸</h2>
        <div id="check-list"></div>
        <button onclick="addCheck()" class="btn btn-blue text-sm mt-2">+ í•­ëª© ì¶”ê°€</button>
    </div>

    <!-- 3. ì¼ì • ê´€ë¦¬ -->
    <div class="card">
        <h2 class="text-xl font-bold mb-4">3. ìƒì„¸ ì¼ì •</h2>
        <p class="text-sm text-gray-500 mb-4">ğŸ’¡ <b>[ğŸ‘‘ ê³µí†µ]</b> íƒ­ì— ì…ë ¥í•˜ë©´ ëª¨ë“  í”Œëœì— ìë™ìœ¼ë¡œ í¬í•¨ë©ë‹ˆë‹¤.</p>
        <div id="days-container"></div>
        <button onclick="addDay()" class="btn btn-blue w-full mt-4">+ ë‚ ì§œ(Day) ì¶”ê°€</button>
    </div>

    <!-- 4. ì •ë³´ ê´€ë¦¬ -->
    <div class="card">
        <h2 class="text-xl font-bold mb-4">4. ìœ ìš©í•œ ì •ë³´</h2>
        <div id="info-list"></div>
        <button onclick="addInfo()" class="btn btn-blue text-sm mt-2">+ ì •ë³´ ì¶”ê°€</button>
    </div>
</div>

<div class="fixed bottom-0 left-0 w-full p-4 bg-white border-t shadow-lg z-50">
    <div class="container flex gap-2">
        <button onclick="openApp()" class="btn btn-green flex-1">ğŸš€ ì•± ì‹¤í–‰ (index.html ì—°ê²°)</button>
        <button onclick="copyLink()" class="btn btn-dark w-24">ğŸ”— ë³µì‚¬</button>
    </div>
</div>

<script>
    let tripData = {
        title: "ë‚˜ë§Œì˜ ì—¬í–‰", theme: "blue", useMulti: false,
        planA: "", planB: "", planC: "",
        checks: [{text:"", type:"all"}],
        days: [{ 
            date: "1ì¼ì°¨", title: "", 
            eventsCommon: [{time:"09:00", icon:"âœˆï¸", type:"fly", title:"ê³µí•­ ë„ì°©", desc:"ì…êµ­ì‹¬ì‚¬", map:""}], 
            eventsA: [], eventsB: [], eventsC: [] 
        }],
        infos: [{ label: "ê²½ì°°ì„œ (110)", val: "110", type: "tel" }]
    };

    const iconOpts = [
        {v:"fly", l:"âœˆï¸ì´ë™"}, {v:"bus", l:"ğŸšŒë²„ìŠ¤"}, {v:"train", l:"ğŸš†ê¸°ì°¨"},
        {v:"car", l:"ğŸš—ì°¨ëŸ‰"}, {v:"food", l:"ğŸ”ì‹ì‚¬"}, {v:"beer", l:"ğŸºìˆ "},
        {v:"camera", l:"ğŸ“·ê´€ê´‘"}, {v:"shop", l:"ğŸ›ï¸ì‡¼í•‘"}, {v:"bed", l:"ğŸ›ï¸ìˆ™ì†Œ"}, {v:"map", l:"ğŸ“ì¥ì†Œ"}
    ];

    // ì‹œê°„ ì˜µì…˜ ìƒì„± (00~23)
    function getHourOpts(selected) {
        let html = '';
        for(let i=0; i<24; i++) {
            let val = i.toString().padStart(2, '0');
            html += `<option value="${val}" ${selected===val?'selected':''}>${val}</option>`;
        }
        return html;
    }
    // ë¶„ ì˜µì…˜ ìƒì„± (00~55, 5ë¶„ ë‹¨ìœ„)
    function getMinOpts(selected) {
        let html = '';
        for(let i=0; i<60; i+=5) {
            let val = i.toString().padStart(2, '0');
            html += `<option value="${val}" ${selected===val?'selected':''}>${val}</option>`;
        }
        return html;
    }

    function toggleMultiPlan() {
        tripData.useMulti = document.getElementById('chkMultiPlan').checked;
        document.getElementById('multiPlanInputs').style.display = tripData.useMulti ? 'grid' : 'none';
        render(); 
    }

    function render() {
        document.getElementById('appTitle').value = tripData.title;
        document.getElementById('themeColor').value = tripData.theme;
        document.getElementById('chkMultiPlan').checked = tripData.useMulti;
        document.getElementById('multiPlanInputs').style.display = tripData.useMulti ? 'grid' : 'none';
        document.getElementById('planAName').value = tripData.planA;
        document.getElementById('planBName').value = tripData.planB;
        document.getElementById('planCName').value = tripData.planC;

        // ì²´í¬ë¦¬ìŠ¤íŠ¸
        const cList = document.getElementById('check-list');
        cList.innerHTML = '';
        tripData.checks.forEach((c, i) => {
            let typeOpts = `<option value="all">ê³µí†µ</option>`;
            if(tripData.useMulti) typeOpts += `<option value="A">Plan A</option><option value="B">Plan B</option><option value="C">Plan C</option>`;
            cList.innerHTML += `<div class="flex gap-2 mb-2"><input class="input-field flex-1" value="${c.text}" placeholder="ì¤€ë¹„ë¬¼" oninput="tripData.checks[${i}].text=this.value"><select class="input-field w-28" onchange="tripData.checks[${i}].type=this.value" style="font-size:0.8rem;">${typeOpts}</select><button class="btn btn-red" onclick="tripData.checks.splice(${i},1); render();">ì‚­ì œ</button></div>`;
            cList.querySelectorAll('select')[i].value = c.type || 'all';
        });

        // ì¼ì •
        const dCont = document.getElementById('days-container');
        dCont.innerHTML = '';
        tripData.days.forEach((d, dIdx) => {
            const activeTab = d._activeTab || (tripData.useMulti ? 'Common' : 'A');
            const nameA = tripData.useMulti ? (tripData.planA || 'Plan A') : 'ìƒì„¸ ì¼ì •';

            let tabHtml = `<div class="plan-tab">`;
            if(tripData.useMulti) tabHtml += `<div class="tab-btn ${activeTab==='Common'?'active-common':''}" onclick="switchDayTab(${dIdx}, 'Common')">ğŸ‘‘ ê³µí†µ</div>`;
            tabHtml += `<div class="tab-btn ${activeTab==='A'?'active-a':''}" onclick="switchDayTab(${dIdx}, 'A')">${nameA}</div>`;
            if(tripData.useMulti) {
                tabHtml += `<div class="tab-btn ${activeTab==='B'?'active-b':''}" onclick="switchDayTab(${dIdx}, 'B')">${tripData.planB||'Plan B'}</div>`;
                tabHtml += `<div class="tab-btn ${activeTab==='C'?'active-c':''}" onclick="switchDayTab(${dIdx}, 'C')">${tripData.planC||'Plan C'}</div>`;
            }
            tabHtml += `</div>`;

            const div = document.createElement('div');
            div.className = 'day-block';
            div.innerHTML = `
                <div class="flex justify-between items-end mb-4">
                    <div class="w-1/3"><label class="text-xs font-bold text-gray-500">ë‚ ì§œ</label><input class="input-field font-bold" value="${d.date}" onchange="updateDay(${dIdx}, 'date', this.value)"></div>
                    <div class="w-1/2 ml-2"><label class="text-xs font-bold text-gray-500">í…Œë§ˆ</label><input class="input-field" value="${d.title}" onchange="updateDay(${dIdx}, 'title', this.value)"></div>
                    <button class="btn btn-red h-8 ml-2" onclick="removeDay(${dIdx})">ì‚­ì œ</button>
                </div>
                ${tabHtml}
                <div style="display:${activeTab==='Common'?'block':'none'}">${renderEvents(d.eventsCommon, dIdx, 'Common')}<button class="w-full py-2 border-2 border-dashed border-yellow-400 text-yellow-600 rounded text-sm hover:bg-yellow-50" onclick="addEvent(${dIdx}, 'Common')">+ ê³µí†µ ì¼ì • ì¶”ê°€</button></div>
                <div style="display:${activeTab==='A'?'block':'none'}">${renderEvents(d.eventsA, dIdx, 'A')}<button class="w-full py-2 border-2 border-dashed border-blue-200 text-blue-500 rounded text-sm hover:bg-blue-50" onclick="addEvent(${dIdx}, 'A')">+ ${nameA} ì¶”ê°€</button></div>
                <div style="display:${activeTab==='B'?'block':'none'}">${renderEvents(d.eventsB, dIdx, 'B')}<button class="w-full py-2 border-2 border-dashed border-pink-200 text-pink-500 rounded text-sm hover:bg-pink-50" onclick="addEvent(${dIdx}, 'B')">+ ì¶”ê°€</button></div>
                <div style="display:${activeTab==='C'?'block':'none'}">${renderEvents(d.eventsC, dIdx, 'C')}<button class="w-full py-2 border-2 border-dashed border-green-200 text-green-500 rounded text-sm hover:bg-green-50" onclick="addEvent(${dIdx}, 'C')">+ ì¶”ê°€</button></div>
            `;
            dCont.appendChild(div);
        });

        // ì •ë³´
        const iCont = document.getElementById('info-list');
        iCont.innerHTML = '';
        if(!tripData.infos) tripData.infos = [];
        tripData.infos.forEach((info, i) => {
            iCont.innerHTML += `<div class="flex gap-2 mb-2 items-center bg-gray-50 p-2 rounded border"><select class="input-field w-24" onchange="tripData.infos[${i}].type=this.value"><option value="tel">ğŸ“ì „í™”</option><option value="link">ğŸ”—ë§í¬</option></select><input class="input-field w-1/3" value="${info.label}" placeholder="ì´ë¦„" oninput="tripData.infos[${i}].label=this.value"><input class="input-field flex-1" value="${info.val}" placeholder="ê°’" oninput="tripData.infos[${i}].val=this.value"><button class="btn btn-red" onclick="tripData.infos.splice(${i},1); render();">X</button></div>`;
            iCont.querySelectorAll('select')[i].value = info.type;
        });
    }

    function renderEvents(events, dIdx, planType) {
        if(!events) return '';
        let typeClass = planType === 'Common' ? 'plan-common' : (planType === 'B' ? 'plan-b' : (planType === 'C' ? 'plan-c' : ''));
        
        return events.map((e, eIdx) => {
            let opts = iconOpts.map(o => `<option value="${o.v}" ${e.type===o.v?'selected':''}>${o.l}</option>`).join('');
            
            // ì‹œê°„ íŒŒì‹± (HH:MM)
            let [hh, mm] = (e.time || "09:00").split(':');
            
            return `
            <div class="event-item ${typeClass}">
                <button class="absolute top-2 right-2 text-red-400 text-xs font-bold" onclick="removeEvent(${dIdx}, ${eIdx}, '${planType}')">X</button>
                <div class="flex gap-2 mb-1 items-center">
                    <!-- ì‹œê°„ ì„ íƒê¸° -->
                    <div class="time-select-group">
                        <select class="time-select" onchange="updateTime(${dIdx}, ${eIdx}, '${planType}', 'h', this.value)">${getHourOpts(hh)}</select>
                        <span>:</span>
                        <select class="time-select" onchange="updateTime(${dIdx}, ${eIdx}, '${planType}', 'm', this.value)">${getMinOpts(mm)}</select>
                    </div>
                    
                    <select class="input-field w-24" onchange="updateEvent(${dIdx}, ${eIdx}, '${planType}', 'type', this.value); updateEvent(${dIdx}, ${eIdx}, '${planType}', 'icon', this.options[this.selectedIndex].text.substring(0,2))">${opts}</select>
                    <input class="input-field flex-1" value="${e.title}" placeholder="ì œëª©" onchange="updateEvent(${dIdx}, ${eIdx}, '${planType}', 'title', this.value)">
                </div>
                <input class="input-field text-sm mb-1" value="${e.desc}" placeholder="ì„¤ëª…" onchange="updateEvent(${dIdx}, ${eIdx}, '${planType}', 'desc', this.value)">
                <div class="relative"><input class="input-field text-sm" value="${e.map||''}" placeholder="êµ¬ê¸€ë§µ ê²€ìƒ‰ì–´" onchange="updateEvent(${dIdx}, ${eIdx}, '${planType}', 'map', this.value)"></div>
            </div>`;
        }).join('');
    }

    // --- ë°ì´í„° ì¡°ì‘ ---
    function updateDay(idx, key, val) { tripData.days[idx][key] = val; }
    function removeDay(idx) { if(confirm('ì‚­ì œí•©ë‹ˆê¹Œ?')) { tripData.days.splice(idx, 1); render(); } }
    function addDay() { tripData.days.push({date:"Day "+(tripData.days.length+1), title:"", eventsCommon:[], eventsA:[], eventsB:[], eventsC:[]}); render(); }
    function switchDayTab(dIdx, tab) { tripData.days[dIdx]._activeTab = tab; render(); }
    
    function addEvent(dIdx, plan) { 
        const newEv = {time:"09:00", type:"map", icon:"ğŸ“", title:"", desc:"", map:""};
        if(plan === 'Common') { if(!tripData.days[dIdx].eventsCommon) tripData.days[dIdx].eventsCommon=[]; tripData.days[dIdx].eventsCommon.push(newEv); }
        else if(plan === 'A') tripData.days[dIdx].eventsA.push(newEv);
        else if(plan === 'B') tripData.days[dIdx].eventsB.push(newEv);
        else tripData.days[dIdx].eventsC.push(newEv);
        render();
    }
    
    function removeEvent(dIdx, eIdx, plan) {
        if(plan === 'Common') tripData.days[dIdx].eventsCommon.splice(eIdx, 1);
        else if(plan === 'A') tripData.days[dIdx].eventsA.splice(eIdx, 1);
        else if(plan === 'B') tripData.days[dIdx].eventsB.splice(eIdx, 1);
        else tripData.days[dIdx].eventsC.splice(eIdx, 1);
        render();
    }
    
    function updateEvent(dIdx, eIdx, plan, key, val) {
        if(plan === 'Common') tripData.days[dIdx].eventsCommon[eIdx][key] = val;
        else if(plan === 'A') tripData.days[dIdx].eventsA[eIdx][key] = val;
        else if(plan === 'B') tripData.days[dIdx].eventsB[eIdx][key] = val;
        else tripData.days[dIdx].eventsC[eIdx][key] = val;
    }

    // ì‹œê°„ ì—…ë°ì´íŠ¸ (ì‹œ/ë¶„ í•©ì³ì„œ time í•„ë“œì— ì €ì¥)
    function updateTime(dIdx, eIdx, plan, part, val) {
        let targetArr = (plan === 'Common') ? tripData.days[dIdx].eventsCommon : 
                        (plan === 'A') ? tripData.days[dIdx].eventsA :
                        (plan === 'B') ? tripData.days[dIdx].eventsB : tripData.days[dIdx].eventsC;
        
        let current = targetArr[eIdx].time || "09:00";
        let [hh, mm] = current.split(':');
        
        if(part === 'h') hh = val;
        else mm = val;
        
        targetArr[eIdx].time = `${hh}:${mm}`;
        // ì‹œê°„ ìˆœ ì •ë ¬ì€ ë·°ì–´ì—ì„œ í•˜ë¯€ë¡œ ì—¬ê¸°ì„  ì €ì¥ë§Œ í•¨
    }
    
    function addCheck() { tripData.checks.push({text:"", type:"all"}); render(); }
    function addInfo() { tripData.infos.push({label:"", val:"", type:"link"}); render(); }
    
    function saveWork() {
        tripData.title = document.getElementById('appTitle').value;
        if(tripData.useMulti) {
            tripData.planA = document.getElementById('planAName').value;
            tripData.planB = document.getElementById('planBName').value;
            tripData.planC = document.getElementById('planCName').value;
        }
        localStorage.setItem('myTripDataV7', JSON.stringify(tripData)); // V7 ì €ì¥ì†Œ
        alert('ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
    }
    
    window.onload = function() {
        const saved = localStorage.getItem('myTripDataV7');
        if(saved && confirm('ì´ì „ ì‘ì—…ì„ ë¶ˆëŸ¬ì˜¬ê¹Œìš”?')) tripData = JSON.parse(saved);
        render();
    }

    function getViewerUrl() {
        saveWork();
        const jsonStr = JSON.stringify(tripData);
        const compressed = LZString.compressToEncodedURIComponent(jsonStr);
        let baseUrl = window.location.href.replace('builder.html', 'index.html');
        if (!baseUrl.includes('index.html')) {
            baseUrl = baseUrl.split('?')[0]; 
            baseUrl = baseUrl.substring(0, baseUrl.lastIndexOf('/') + 1) + 'index.html';
        }
        return baseUrl + "#data=" + compressed;
    }
    function openApp() { window.open(getViewerUrl(), '_blank'); }
    function copyLink() { navigator.clipboard.writeText(getViewerUrl()).then(() => alert("ë§í¬ ë³µì‚¬ ì™„ë£Œ!")); }
</script>
</body>
</html>