<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ì—¬í–‰ ê°€ì´ë“œ ë¹Œë” ğŸ› ï¸</title>
<script src="https://cdn.tailwindcss.com"></script>
<!-- ë°ì´í„° ì••ì¶•ì„ ìœ„í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/lz-string/1.4.4/lz-string.min.js"></script>
<style>
    body { font-family: -apple-system, sans-serif; background: #f3f4f6; padding: 20px; padding-bottom: 100px; }
    .container { max-width: 800px; margin: 0 auto; }
    .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-bottom: 20px; }
    .input-field { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 6px; margin-bottom: 5px; }
    .btn { padding: 8px 16px; border-radius: 6px; font-weight: bold; cursor: pointer; border: none; color: white; }
    .btn-blue { background: #3b82f6; }
    .btn-green { background: #10b981; width: 100%; padding: 15px; font-size: 1.1rem; }
    .btn-red { background: #ef4444; font-size: 0.8rem; }
    .day-block { border-left: 4px solid #3b82f6; padding-left: 15px; margin-bottom: 30px; }
    .event-item { background: #f9fafb; padding: 10px; border-radius: 8px; margin-bottom: 8px; border: 1px solid #eee; position: relative; }
</style>
</head>
<body>

<div class="container">
    <h1 class="text-2xl font-bold mb-6 text-gray-800">ğŸ§³ ì—¬í–‰ ê°€ì´ë“œ ë¹Œë” (Link ë°©ì‹)</h1>

    <div class="card">
        <h2 class="text-xl font-bold mb-4">1. ê¸°ë³¸ ì„¤ì •</h2>
        <label class="block mb-2 font-bold text-sm text-gray-600">ì—¬í–‰ ì œëª©</label>
        <input type="text" id="appTitle" class="input-field" value="ë‚˜ë§Œì˜ ì‹œì¦ˆì˜¤ì¹´ ì—¬í–‰">
        <label class="block mb-2 font-bold text-sm text-gray-600 mt-2">í…Œë§ˆ ìƒ‰ìƒ</label>
        <select id="themeColor" class="input-field">
            <option value="blue">ë¸”ë£¨ (ê¸°ë³¸)</option>
            <option value="pink">í•‘í¬ (ë²šê½ƒ)</option>
            <option value="green">ê·¸ë¦° (ìì—°)</option>
            <option value="purple">í¼í”Œ (ì•¼ê²½)</option>
        </select>
    </div>

    <div class="card">
        <h2 class="text-xl font-bold mb-4">2. ì²´í¬ë¦¬ìŠ¤íŠ¸</h2>
        <div id="check-list"></div>
        <button onclick="addCheck()" class="btn btn-blue text-sm mt-2">+ í•­ëª© ì¶”ê°€</button>
    </div>

    <div class="card">
        <h2 class="text-xl font-bold mb-4">3. ì¼ì • ê´€ë¦¬</h2>
        <div id="days-list"></div>
        <button onclick="addDay()" class="btn btn-blue w-full mt-4">+ ë‚ ì§œ ì¶”ê°€</button>
    </div>
</div>

<div class="fixed bottom-0 left-0 w-full p-4 bg-white border-t shadow-lg z-50">
    <div class="container flex gap-2">
        <button onclick="openViewer()" class="btn btn-green flex-1">âœˆï¸ ì—¬í–‰ ì•± ì‹¤í–‰í•˜ê¸° (ìƒˆì°½)</button>
        <button onclick="copyLink()" class="btn bg-gray-600 flex-none w-24">ğŸ”— ë§í¬ë³µì‚¬</button>
    </div>
</div>

<script>
    // --- ì´ˆê¸° ë°ì´í„° ---
    let tripData = {
        title: "ì‹œì¦ˆì˜¤ì¹´ ì—¬í–‰", theme: "blue",
        checks: [{text:"ì—¬ê¶Œ"}, {text:"ë¼ì§€ì½”"}, {text:"ë™ì „ì§€ê°‘"}],
        days: [
            { date: "1ì¼ì°¨", title: "ì¶œêµ­ & ë„ì°©", events: [
                {time:"10:00", icon:"âœˆï¸", type:"fly", title:"ê³µí•­ ë„ì°©", desc:"ì…êµ­ì‹¬ì‚¬", map:""}
            ]}
        ]
    };

    // ì €ì¥ëœ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
    if(localStorage.getItem('myTripData')) {
        tripData = JSON.parse(localStorage.getItem('myTripData'));
    }

    const iconOpts = [
        {v:"fly", l:"âœˆï¸ì´ë™"}, {v:"food", l:"ğŸ”ì‹ì‚¬"}, {v:"camera", l:"ğŸ“·ê´€ê´‘"},
        {v:"shop", l:"ğŸ›ï¸ì‡¼í•‘"}, {v:"bed", l:"ğŸ›ï¸ìˆ™ì†Œ"}, {v:"map", l:"ğŸ“ì¥ì†Œ"}
    ];

    function render() {
        document.getElementById('appTitle').value = tripData.title;
        document.getElementById('themeColor').value = tripData.theme;

        // ì²´í¬ë¦¬ìŠ¤íŠ¸
        const cList = document.getElementById('check-list');
        cList.innerHTML = '';
        tripData.checks.forEach((c, i) => {
            cList.innerHTML += `
                <div class="flex gap-2 mb-2">
                    <input class="input-field" value="${c.text}" oninput="tripData.checks[${i}].text=this.value; save();">
                    <button class="btn btn-red" onclick="tripData.checks.splice(${i},1); render(); save();">ì‚­ì œ</button>
                </div>`;
        });

        // ì¼ì •
        const dList = document.getElementById('days-list');
        dList.innerHTML = '';
        tripData.days.forEach((d, di) => {
            let evHtml = '';
            d.events.forEach((e, ei) => {
                let opts = iconOpts.map(o => `<option value="${o.v}" ${e.type===o.v?'selected':''}>${o.l}</option>`).join('');
                evHtml += `
                    <div class="event-item">
                        <button class="absolute top-2 right-2 text-red-500 text-xs font-bold" onclick="tripData.days[${di}].events.splice(${ei},1); render(); save();">X ì‚­ì œ</button>
                        <div class="flex gap-2 mb-1">
                            <input class="input-field w-20" value="${e.time}" oninput="updateEv(${di},${ei},'time',this.value)">
                            <select class="input-field w-24" onchange="updateEv(${di},${ei},'type',this.value); updateEv(${di},${ei},'icon',this.options[this.selectedIndex].text.substring(0,2))">${opts}</select>
                            <input class="input-field" value="${e.title}" oninput="updateEv(${di},${ei},'title',this.value)">
                        </div>
                        <input class="input-field text-sm mb-1" placeholder="ì„¤ëª…" value="${e.desc}" oninput="updateEv(${di},${ei},'desc',this.value)">
                        <input class="input-field text-sm" placeholder="ì§€ë„ ê²€ìƒ‰ì–´ (ì˜ˆ: ì‹œì¦ˆì˜¤ì¹´ ì—­)" value="${e.map||''}" oninput="updateEv(${di},${ei},'map',this.value)">
                    </div>`;
            });

            dList.innerHTML += `
                <div class="day-block">
                    <div class="flex justify-between items-end mb-2 pr-2">
                        <div class="w-1/3"><label class="text-xs font-bold text-blue-600">ë‚ ì§œ</label><input class="input-field font-bold" value="${d.date}" oninput="tripData.days[${di}].date=this.value; save();"></div>
                        <div class="w-1/2 ml-2"><label class="text-xs font-bold text-gray-500">í…Œë§ˆ</label><input class="input-field" value="${d.title}" oninput="tripData.days[${di}].title=this.value; save();"></div>
                        <button class="btn btn-red h-8 ml-2" onclick="tripData.days.splice(${di},1); render(); save();">Dayì‚­ì œ</button>
                    </div>
                    ${evHtml}
                    <button class="w-full py-2 border-2 border-dashed border-gray-300 text-gray-500 rounded text-sm hover:bg-gray-50" onclick="addEv(${di})">+ ì¼ì • ì¶”ê°€</button>
                </div>`;
        });
    }

    // --- ë¡œì§ ---
    function save() {
        tripData.title = document.getElementById('appTitle').value;
        tripData.theme = document.getElementById('themeColor').value;
        localStorage.setItem('myTripData', JSON.stringify(tripData));
    }
    function updateEv(di, ei, key, val) { tripData.days[di].events[ei][key] = val; save(); }
    function addCheck() { tripData.checks.push({text:""}); render(); save(); }
    function addDay() { tripData.days.push({date:"Day "+(tripData.days.length+1), title:"ìƒˆ ì¼ì •", events:[]}); render(); save(); }
    function addEv(di) { tripData.days[di].events.push({time:"00:00", type:"map", icon:"ğŸ“", title:"", desc:""}); render(); save(); }

    // --- í•µì‹¬: ë§í¬ ìƒì„±ê¸° ---
    function getViewerUrl() {
        save();
        // 1. ë°ì´í„° JSON ë¬¸ìì—´í™”
        const jsonStr = JSON.stringify(tripData);
        // 2. LZStringìœ¼ë¡œ ì••ì¶• (URL ê¸¸ì´ ì¤„ì´ê¸° ìœ„í•´ í•„ìˆ˜)
        const compressed = LZString.compressToEncodedURIComponent(jsonStr);
        // 3. ê°™ì€ í´ë”ì˜ index.htmlë¡œ ë§í¬ ìƒì„±
        // ë¡œì»¬ í…ŒìŠ¤íŠ¸ìš© vs í˜¸ìŠ¤íŒ…ìš© êµ¬ë¶„
        let baseUrl = window.location.href.replace('builder.html', 'index.html');
        // ë§Œì•½ íŒŒì¼ëª…ì´ ë‹¤ë¥¼ ìˆ˜ ìˆìœ¼ë‹ˆ ì•ˆì „í•˜ê²Œ ì²˜ë¦¬
        if (!baseUrl.includes('index.html')) {
            baseUrl = baseUrl.split('?')[0]; 
            if(baseUrl.endsWith('/')) baseUrl += 'index.html';
            else baseUrl = baseUrl.substring(0, baseUrl.lastIndexOf('/')) + '/index.html';
        }
        
        return baseUrl + "#data=" + compressed;
    }

    function openViewer() {
        const url = getViewerUrl();
        window.open(url, '_blank');
    }

    function copyLink() {
        const url = getViewerUrl();
        navigator.clipboard.writeText(url).then(() => alert("ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤! ì¹œêµ¬ì—ê²Œ ê³µìœ í•˜ì„¸ìš”."));
    }

    render();
</script>
</body>
</html>