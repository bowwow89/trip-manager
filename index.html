<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>ì—¬í–‰ ê°€ì´ë“œ</title>
<!-- ì••ì¶• í•´ì œ ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/lz-string/1.4.4/lz-string.min.js"></script>
<style>
    /* V28 ë””ìì¸ ìŠ¤íƒ€ì¼ ê·¸ëŒ€ë¡œ ìœ ì§€ */
    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; margin: 0; padding: 0; }
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif; background-color: #f3f4f6; color: #1f2937; height: 100dvh; display: flex; justify-content: center; overflow: hidden; }
    .app-container { width: 100%; max-width: 480px; height: 100%; background-color: #fff; display: flex; flex-direction: column; position: relative; box-shadow: 0 0 20px rgba(0,0,0,0.1); }
    
    /* Header */
    header { padding: 1.5rem; padding-bottom: 1.2rem; border-bottom-left-radius: 1.5rem; border-bottom-right-radius: 1.5rem; color: white; flex-shrink: 0; z-index: 30; transition: all 0.3s ease; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
    header.shrink { padding: 0.8rem 1rem; border-radius: 0 0 1rem 1rem; }
    .bg-blue { background: linear-gradient(135deg, #3b82f6, #06b6d4); }
    .bg-pink { background: linear-gradient(135deg, #ec4899, #f43f5e); }
    .bg-green { background: linear-gradient(135deg, #10b981, #059669); }
    .bg-purple { background: linear-gradient(135deg, #8b5cf6, #6366f1); }
    
    .title { font-size: 1.4rem; font-weight: 800; margin-bottom: 0.5rem; }
    header.shrink .title { font-size: 1.1rem; margin-bottom: 0; }
    .subtitle { font-size: 0.85rem; opacity: 0.9; }
    header.shrink .subtitle { display: none; }

    /* Main */
    main { flex: 1; overflow-y: auto; padding: 1rem; padding-bottom: 5rem; scroll-behavior: smooth; }
    .card { background: white; border-radius: 1rem; padding: 1rem; box-shadow: 0 2px 5px rgba(0,0,0,0.05); margin-bottom: 1rem; border: 1px solid #f3f4f6; }
    .card-title { font-size: 1.1rem; font-weight: 800; margin-bottom: 1rem; color: #374151; border-bottom: 2px solid #f3f4f6; padding-bottom: 0.5rem; }
    
    /* Tabs & Timeline */
    .day-tabs { display: flex; gap: 0.5rem; overflow-x: auto; padding-bottom: 0.5rem; margin-bottom: 0.5rem; }
    .day-tabs::-webkit-scrollbar { display: none; }
    .day-btn { flex-shrink: 0; padding: 0.4rem 1rem; border-radius: 999px; font-size: 0.9rem; font-weight: bold; border: none; cursor: pointer; transition: all 0.2s; background: #f3f4f6; color: #6b7280; }
    .day-btn.active { background: #1f2937; color: white; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }

    .event-item { display: flex; gap: 1rem; margin-bottom: 1.5rem; position: relative; }
    .event-item::before { content: ''; position: absolute; left: 19px; top: 2.5rem; bottom: -1.5rem; width: 2px; background-color: #e5e7eb; z-index: 0; }
    .event-item:last-child::before { display: none; }
    .icon-box { width: 40px; height: 40px; flex-shrink: 0; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; z-index: 1; position: relative; box-shadow: 0 2px 4px rgba(0,0,0,0.05); background: #eff6ff; }
    
    .time-badge { font-size: 0.75rem; font-weight: 700; color: #6b7280; background: #f3f4f6; padding: 2px 6px; border-radius: 4px; display: inline-block; margin-bottom: 4px; }
    .event-title { font-size: 1rem; font-weight: 700; color: #1f2937; margin-bottom: 2px; }
    .event-desc { font-size: 0.85rem; color: #6b7280; line-height: 1.4; white-space: pre-line; }
    .btn-map { margin-top: 6px; display: inline-flex; align-items: center; gap: 4px; font-size: 0.75rem; font-weight: 600; color: #2563eb; background: #eff6ff; padding: 4px 8px; border-radius: 6px; border: none; cursor: pointer; }

    /* Checklist */
    .check-item { display: flex; align-items: center; gap: 0.8rem; padding: 0.8rem; border-bottom: 1px solid #f3f4f6; cursor: pointer; }
    .check-box { width: 1.2rem; height: 1.2rem; border-radius: 4px; border: 2px solid #d1d5db; display: flex; align-items: center; justify-content: center; color: white; font-size: 0.8rem; transition: all 0.2s; }
    .checked .check-box { background: #10b981; border-color: #10b981; }
    .checked span { text-decoration: line-through; color: #9ca3af; }

    /* Nav */
    nav { position: absolute; bottom: 0; width: 100%; background: white; border-top: 1px solid #e5e7eb; display: flex; justify-content: space-around; padding: 0.8rem 0; padding-bottom: max(0.8rem, env(safe-area-inset-bottom)); z-index: 40; }
    .nav-btn { background: none; border: none; font-size: 0.7rem; font-weight: 600; color: #9ca3af; display: flex; flex-direction: column; align-items: center; gap: 4px; cursor: pointer; width: 33%; }
    .nav-btn.active { color: #1f2937; }
    .nav-btn svg { width: 24px; height: 24px; stroke-width: 2px; }

    /* Loading / Empty State */
    .empty-state { text-align: center; padding: 3rem 1rem; color: #6b7280; }
    .empty-btn { margin-top: 1rem; padding: 0.5rem 1rem; background: #3b82f6; color: white; border-radius: 0.5rem; text-decoration: none; display: inline-block; font-weight: bold; }
</style>
</head>
<body>

<div class="app-container">
    <header id="header" class="bg-blue">
        <div class="title" id="disp-title">ì—¬í–‰ ê°€ì´ë“œ</div>
        <div class="subtitle" id="disp-date">ì¦ê±°ìš´ ì—¬í–‰ ë˜ì„¸ìš”!</div>
    </header>

    <main id="main-scroll">
        <div id="content-area"></div>
    </main>

    <nav>
        <button onclick="setTab('sch')" class="nav-btn active" id="btn-sch">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
            ì¼ì •
        </button>
        <button onclick="setTab('chk')" class="nav-btn" id="btn-chk">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><polyline points="9 11 12 14 22 4"></polyline><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path></svg>
            ì²´í¬
        </button>
        <button onclick="setTab('info')" class="nav-btn" id="btn-info">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>
            ì •ë³´
        </button>
    </nav>
</div>

<script>
    // --- 1. ë°ì´í„° ë¡œë“œ ë¡œì§ ---
    let TRIP_CONFIG = null;
    let state = { tab: 'sch', dayIdx: 0, checked: {} };

    function loadData() {
        // 1. URL í•´ì‹œ(#data=...) í™•ì¸
        const hash = window.location.hash;
        if (hash && hash.startsWith('#data=')) {
            try {
                const compressed = hash.substring(6); // '#data=' ì œê±°
                const jsonStr = LZString.decompressFromEncodedURIComponent(compressed);
                if (jsonStr) TRIP_CONFIG = JSON.parse(jsonStr);
            } catch (e) { console.error("ë°ì´í„° íŒŒì‹± ì‹¤íŒ¨", e); }
        }

        // 2. ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ìƒ˜í”Œ/ì•ˆë‚´ í‘œì‹œ
        if (!TRIP_CONFIG) {
            document.getElementById('content-area').innerHTML = `
                <div class="empty-state">
                    <div style="font-size:3rem; margin-bottom:1rem;">ğŸ“‚</div>
                    <h3>ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</h3>
                    <p>ê´€ë¦¬ì í˜ì´ì§€(builder.html)ì—ì„œ<br>ì¼ì •ì„ ë§Œë“  í›„ 'ì•± ì‹¤í–‰'ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.</p>
                    <a href="builder.html" class="empty-btn">ê´€ë¦¬ì í˜ì´ì§€ë¡œ ì´ë™</a>
                </div>`;
            return false;
        }

        // 3. ë¡œì»¬ ì²´í¬ë¦¬ìŠ¤íŠ¸ ìƒíƒœ ë³µêµ¬
        const savedChecks = localStorage.getItem('trip_checks_' + TRIP_CONFIG.title);
        if(savedChecks) state.checked = JSON.parse(savedChecks);

        return true;
    }

    // --- 2. ë Œë”ë§ ë¡œì§ (V28 ìŠ¤íƒ€ì¼) ---
    function render() {
        if (!TRIP_CONFIG) return;

        // í…Œë§ˆ ì ìš©
        document.getElementById('header').className = 'bg-' + (TRIP_CONFIG.theme || 'blue');
        document.getElementById('disp-title').innerText = TRIP_CONFIG.title;

        const content = document.getElementById('content-area');
        content.innerHTML = '';

        // íƒ­ UI
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        document.getElementById('btn-' + state.tab).classList.add('active');

        if (state.tab === 'sch') renderSchedule(content);
        else if (state.tab === 'chk') renderChecklist(content);
        else renderInfo(content);
    }

    function renderSchedule(container) {
        if (!TRIP_CONFIG.days || TRIP_CONFIG.days.length === 0) {
            container.innerHTML = '<div class="card">ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
            return;
        }

        // ë‚ ì§œ íƒ­
        let tabsHtml = '<div class="day-tabs">';
        TRIP_CONFIG.days.forEach((day, idx) => {
            const activeClass = idx === state.dayIdx ? 'active' : '';
            tabsHtml += `<button onclick="setDay(${idx})" class="day-btn ${activeClass}">${day.date}</button>`;
        });
        tabsHtml += '</div>';

        // ì¼ì • ë¦¬ìŠ¤íŠ¸
        const currentDay = TRIP_CONFIG.days[state.dayIdx];
        document.getElementById('disp-date').innerText = currentDay.title || (currentDay.date + " ì¼ì •");

        let listHtml = '<div class="timeline">';
        if (currentDay.events.length === 0) listHtml += '<div class="card">ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
        
        currentDay.events.forEach(evt => {
            const mapBtn = evt.map ? `<button onclick="openMap('${evt.map}')" class="btn-map">ğŸ“ ì§€ë„</button>` : '';
            listHtml += `
                <div class="event-item">
                    <div class="icon-box">${evt.icon}</div>
                    <div style="flex:1; padding-top:4px;">
                        <div style="display:flex; justify-content:space-between;">
                            <span class="time-badge">${evt.time}</span>
                            ${mapBtn}
                        </div>
                        <div class="event-title">${evt.title}</div>
                        <div class="event-desc">${evt.desc}</div>
                    </div>
                </div>`;
        });
        listHtml += '</div>';
        container.innerHTML = tabsHtml + '<div class="card">' + listHtml + '</div>';
    }

    function renderChecklist(container) {
        document.getElementById('disp-date').innerText = "ì¤€ë¹„ë¬¼ ì²´í¬ë¦¬ìŠ¤íŠ¸";
        let html = '<div class="card"><div class="card-title">ğŸ‘œ ì§ì‹¸ê¸° ëª©ë¡</div>';
        
        TRIP_CONFIG.checks.forEach((item, idx) => {
            const isChecked = state.checked[idx];
            html += `
                <div class="check-item ${isChecked ? 'checked' : ''}" onclick="toggleCheck(${idx})">
                    <div class="check-box">${isChecked ? 'âœ”' : ''}</div>
                    <span>${item.text}</span>
                </div>`;
        });
        html += '</div>';
        container.innerHTML = html;
    }

    function renderInfo(container) {
        document.getElementById('disp-date').innerText = "ìœ ìš©í•œ ì •ë³´";
        container.innerHTML = `
            <div class="card">
                <div class="card-title">ğŸ†˜ ê¸´ê¸‰ ì—°ë½ì²˜</div>
                <div class="check-item" onclick="location.href='tel:110'">ğŸ‘®â€â™‚ï¸ ê²½ì°°ì„œ (110)</div>
                <div class="check-item" onclick="location.href='tel:119'">ğŸš‘ êµ¬ê¸‰ì°¨ (119)</div>
            </div>
            <div class="card">
                <div class="card-title">ğŸ”— ë°”ë¡œê°€ê¸°</div>
                <div class="check-item" onclick="window.open('https://translate.google.com')">ğŸ—£ï¸ êµ¬ê¸€ ë²ˆì—­ê¸°</div>
                <div class="check-item" onclick="window.open('https://www.google.com/maps')">ğŸ—ºï¸ êµ¬ê¸€ ì§€ë„</div>
            </div>`;
    }

    // --- Actions ---
    window.setTab = (t) => { state.tab = t; render(); window.scrollTo(0,0); };
    window.setDay = (idx) => { state.dayIdx = idx; render(); };
    window.toggleCheck = (idx) => {
        state.checked[idx] = !state.checked[idx];
        localStorage.setItem('trip_checks_' + TRIP_CONFIG.title, JSON.stringify(state.checked));
        render();
    };
    window.openMap = (q) => { window.open('https://www.google.com/maps/search/?api=1&query=' + encodeURIComponent(q)); };

    // ìŠ¤í¬ë¡¤ íš¨ê³¼
    document.getElementById('main-scroll').addEventListener('scroll', function() {
        const header = document.getElementById('header');
        if (this.scrollTop > 20) header.classList.add('shrink');
        else header.classList.remove('shrink');
    });

    // ì‹œì‘
    if(loadData()) render();

</script>
</body>
</html>