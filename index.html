<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ì—¬í–‰ ê°€ì´ë“œ</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/lz-string/1.4.4/lz-string.min.js"></script>
<style>
    /* Reset */
    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; margin: 0; padding: 0; }
    body { font-family: -apple-system, sans-serif; background: #f3f4f6; color: #1f2937; height: 100dvh; display: flex; justify-content: center; overflow: hidden; }
    .app-container { width: 100%; max-width: 480px; height: 100%; background: #fff; display: flex; flex-direction: column; position: relative; }
    
    /* Header */
    header { padding: 1.5rem; padding-bottom: 1rem; color: white; transition: 0.3s; z-index: 10; box-shadow: 0 4px 6px rgba(0,0,0,0.1); border-radius: 0 0 1.5rem 1.5rem; flex-shrink: 0; }
    header.shrink { padding: 0.8rem 1rem; border-radius: 0 0 1rem 1rem; }
    .bg-blue { background: linear-gradient(to right, #3b82f6, #06b6d4); }
    .bg-pink { background: linear-gradient(to right, #ec4899, #f43f5e); }
    .bg-green { background: linear-gradient(to right, #10b981, #059669); }
    .bg-purple { background: linear-gradient(to right, #8b5cf6, #6366f1); }
    .bg-gray { background: #4b5563; } /* ë°ì´í„° ì—†ì„ ë•Œ ê¸°ë³¸ìƒ‰ */

    .title { font-size: 1.5rem; font-weight: 800; margin-bottom: 5px; }
    header.shrink .title { font-size: 1.1rem; margin: 0; }
    
    /* Multi Mode Toggle */
    .mode-toggle { display: flex; background: rgba(0,0,0,0.15); border-radius: 99px; padding: 3px; margin-top: 10px; width: fit-content; max-width: 100%; overflow-x: auto; gap: 4px; }
    header.shrink .mode-toggle { display: none; }
    .mode-btn { padding: 5px 12px; border-radius: 99px; border: none; font-size: 0.85rem; font-weight: bold; cursor: pointer; color: rgba(255,255,255,0.8); background: transparent; white-space: nowrap; transition: 0.2s; }
    .mode-btn.active { background: white; color: #333; box-shadow: 0 1px 2px rgba(0,0,0,0.1); }

    /* Content */
    main { flex: 1; overflow-y: auto; padding: 1rem; padding-bottom: 5rem; scroll-behavior: smooth; }
    .card { background: white; border-radius: 1rem; padding: 1rem; box-shadow: 0 2px 4px rgba(0,0,0,0.05); margin-bottom: 1rem; border: 1px solid #f3f4f6; }
    .card-title { font-size: 1.1rem; font-weight: 800; margin-bottom: 1rem; color: #374151; border-bottom: 2px solid #f3f4f6; padding-bottom: 0.5rem; }

    /* Day Tabs */
    .day-tabs { display: flex; gap: 8px; overflow-x: auto; padding-bottom: 5px; margin-bottom: 10px; }
    .day-tabs::-webkit-scrollbar { display: none; }
    .day-btn { white-space: nowrap; padding: 8px 14px; border-radius: 99px; font-size: 0.9rem; font-weight: bold; border: none; background: #f3f4f6; color: #6b7280; cursor: pointer; }
    .day-btn.active { background: #1f2937; color: white; }

    /* Timeline */
    .event-item { display: flex; gap: 12px; margin-bottom: 20px; position: relative; }
    .event-item::before { content: ''; position: absolute; left: 19px; top: 35px; bottom: -20px; width: 2px; background: #e5e7eb; z-index: 0; }
    .event-item:last-child::before { display: none; }
    
    .icon-box { width: 40px; height: 40px; flex-shrink: 0; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.3rem; z-index: 1; position: relative; background: #eff6ff; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
    .type-fly { background: #dbeafe; color: #2563eb; } .type-bus { background: #dcfce7; color: #16a34a; }
    .type-car { background: #e0e7ff; color: #4f46e5; } .type-food { background: #ffedd5; color: #ea580c; }
    .type-beer { background: #fef9c3; color: #ca8a04; } .type-camera { background: #fce7f3; color: #db2777; }
    .type-shop { background: #f3e8ff; color: #9333ea; } .type-bed { background: #f3f4f6; color: #4b5563; }

    .time { font-size: 0.75rem; font-weight: bold; color: #6b7280; background: #f3f4f6; padding: 2px 6px; border-radius: 4px; }
    .evt-title { font-size: 1rem; font-weight: bold; color: #1f2937; margin: 2px 0; }
    .evt-desc { font-size: 0.85rem; color: #6b7280; line-height: 1.4; white-space: pre-wrap; }
    .btn-map { display: inline-flex; align-items: center; font-size: 0.75rem; font-weight: 600; color: #2563eb; background: #eff6ff; padding: 3px 8px; border-radius: 6px; margin-left: auto; cursor: pointer; border: none; }

    /* Check & Nav */
    .check-item { display: flex; align-items: center; gap: 10px; padding: 12px; border-bottom: 1px solid #f3f4f6; cursor: pointer; }
    .check-box { width: 20px; height: 20px; border-radius: 4px; border: 2px solid #d1d5db; display: flex; align-items: center; justify-content: center; color: white; font-size: 12px; }
    .checked .check-box { background: #10b981; border-color: #10b981; }
    .checked span { text-decoration: line-through; color: #9ca3af; }

    nav { position: absolute; bottom: 0; width: 100%; background: white; border-top: 1px solid #e5e7eb; display: flex; justify-content: space-around; padding: 12px 0; padding-bottom: max(12px, env(safe-area-inset-bottom)); z-index: 50; }
    .nav-btn { background: none; border: none; font-size: 0.7rem; font-weight: 600; color: #9ca3af; display: flex; flex-direction: column; align-items: center; gap: 4px; cursor: pointer; width: 33%; }
    .nav-btn.active { color: #1f2937; }
    .nav-btn svg { width: 24px; height: 24px; stroke-width: 2px; }

    /* Empty State Landing */
    .landing-container { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; text-align: center; padding: 2rem; }
    .landing-icon { font-size: 4rem; margin-bottom: 1rem; }
    .landing-title { font-size: 1.5rem; font-weight: 800; color: #1f2937; margin-bottom: 0.5rem; }
    .landing-desc { font-size: 0.9rem; color: #6b7280; margin-bottom: 2rem; }
    .landing-btn { background: #3b82f6; color: white; padding: 12px 24px; border-radius: 99px; font-weight: bold; text-decoration: none; box-shadow: 0 4px 6px rgba(59, 130, 246, 0.3); transition: 0.2s; }
    .landing-btn:active { transform: scale(0.95); }

</style>
</head>
<body>

<div class="app-container" id="app-container">
    <header id="header" class="bg-gray">
        <div class="title" id="disp-title">ì—¬í–‰ ê°€ì´ë“œ</div>
        <div id="subtitle" style="font-size:0.85rem; opacity:0.9;">Trip Manager</div>
        
        <!-- ëª¨ë“œ ì„ íƒ (ë™ì  ìƒì„±) -->
        <div id="mode-toggle-area" class="mode-toggle" style="display:none;"></div>
    </header>

    <main id="main-scroll">
        <div id="content-area"></div>
    </main>

    <nav id="main-nav">
        <button onclick="setTab('sch')" class="nav-btn active" id="btn-sch">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>ì¼ì •
        </button>
        <button onclick="setTab('chk')" class="nav-btn" id="btn-chk">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><polyline points="9 11 12 14 22 4"></polyline><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path></svg>ì²´í¬
        </button>
        <button onclick="setTab('info')" class="nav-btn" id="btn-info">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>ì •ë³´
        </button>
    </nav>
</div>

<script>
    let TRIP_DATA = null;
    let state = { tab: 'sch', dayIdx: 0, mode: 'A', checked: {} };

    // --- 1. ë°ì´í„° ë¡œë“œ (URL Hash) ---
    function loadData() {
        const hash = window.location.hash;
        if (hash && hash.startsWith('#data=')) {
            try {
                const compressed = hash.substring(6);
                const jsonStr = LZString.decompressFromEncodedURIComponent(compressed);
                if (jsonStr) TRIP_DATA = JSON.parse(jsonStr);
            } catch (e) { console.error("Data Load Error", e); }
        }

        // â­ ë°ì´í„°ê°€ ì—†ì„ ë•Œ: ëœë”© í˜ì´ì§€ í‘œì‹œ
        if (!TRIP_DATA) {
            document.getElementById('app-container').innerHTML = `
                <div class="landing-container">
                    <div class="landing-icon">ğŸ§³</div>
                    <div class="landing-title">ë‚˜ë§Œì˜ ì—¬í–‰ ê°€ì´ë“œ</div>
                    <div class="landing-desc">
                        ì•„ì§ ìƒì„±ëœ ì—¬í–‰ ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤.<br>
                        ë¹Œë”ì—ì„œ ì—¬í–‰ ê³„íšì„ ë§Œë“¤ì–´ë³´ì„¸ìš”!
                    </div>
                    <a href="builder_v3.html" class="landing-btn">âœ¨ ì—¬í–‰ ë§Œë“¤ê¸° (ë¹Œë” ì´ë™)</a>
                </div>
            `;
            return false;
        }

        // ì²´í¬ ìƒíƒœ ë¡œë“œ
        const savedChecks = localStorage.getItem('chk_' + TRIP_DATA.title);
        if(savedChecks) state.checked = JSON.parse(savedChecks);
        
        return true;
    }

    // --- 2. ì´ˆê¸°í™” ---
    function init() {
        if(!loadData()) return;

        document.getElementById('disp-title').innerText = TRIP_DATA.title;
        document.getElementById('header').className = 'bg-' + (TRIP_DATA.theme || 'blue');
        
        // ë©€í‹° í”Œëœ ë²„íŠ¼ ìƒì„± ë¡œì§
        const toggleArea = document.getElementById('mode-toggle-area');
        toggleArea.innerHTML = ''; 

        if(TRIP_DATA.useMulti) {
            let html = '';
            // Plan A
            const nameA = TRIP_DATA.planA || 'Plan A';
            html += `<button onclick="setMode('A')" id="btn-mode-a" class="mode-btn">${nameA}</button>`;
            
            // Plan B
            if(TRIP_DATA.planB) {
                html += `<button onclick="setMode('B')" id="btn-mode-b" class="mode-btn">${TRIP_DATA.planB}</button>`;
            }
            // Plan C
            if(TRIP_DATA.planC) {
                html += `<button onclick="setMode('C')" id="btn-mode-c" class="mode-btn">${TRIP_DATA.planC}</button>`;
            }
            
            toggleArea.innerHTML = html;
            toggleArea.style.display = 'flex';
        } else {
            toggleArea.style.display = 'none';
        }

        render();
    }

    // --- 3. ë Œë”ë§ ---
    function render() {
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        document.getElementById('btn-' + state.tab).classList.add('active');
        
        const content = document.getElementById('content-area');
        content.innerHTML = '';

        if(state.tab === 'sch') renderSchedule(content);
        else if(state.tab === 'chk') renderChecklist(content);
        else renderInfo(content);

        // ëª¨ë“œ ë²„íŠ¼ ìŠ¤íƒ€ì¼ í™œì„±í™”
        if(TRIP_DATA.useMulti) {
            ['A','B','C'].forEach(m => {
                const btn = document.getElementById('btn-mode-' + m.toLowerCase());
                if(btn) btn.className = state.mode === m ? 'mode-btn active' : 'mode-btn';
            });
        }
    }

    function renderSchedule(cont) {
        if(!TRIP_DATA.days.length) { cont.innerHTML = '<div class="card">ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤.</div>'; return; }

        let tabs = '<div class="day-tabs">';
        TRIP_DATA.days.forEach((d, i) => {
            tabs += `<button onclick="setDay(${i})" class="day-btn ${i===state.dayIdx?'active':''}">${d.date}</button>`;
        });
        tabs += '</div>';

        const curDay = TRIP_DATA.days[state.dayIdx];
        let events = [];
        let planName = "";

        if(state.mode === 'B') { events = curDay.eventsB; planName = TRIP_DATA.planB; }
        else if(state.mode === 'C') { events = curDay.eventsC; planName = TRIP_DATA.planC; }
        else { events = curDay.eventsA; planName = TRIP_DATA.planA; } 

        if(TRIP_DATA.useMulti) {
            document.getElementById('subtitle').innerText = (planName || ('Plan '+state.mode)) + ' ì¼ì •';
        } else {
            document.getElementById('subtitle').innerText = curDay.title || 'ì¦ê±°ìš´ ì—¬í–‰ ë˜ì„¸ìš”!';
        }

        let list = '<div class="card">';
        if(!events || events.length === 0) {
            list += `<div style="text-align:center; padding:20px; color:#9ca3af;">ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤.</div>`;
        } else {
            events.forEach(e => {
                const mapBtn = e.map ? `<button onclick="openMap('${e.map}')" class="btn-map">ğŸ“ ì§€ë„</button>` : '';
                list += `
                <div class="event-item">
                    <div class="icon-box type-${e.type}">${e.icon}</div>
                    <div style="flex:1;">
                        <div style="display:flex; justify-content:space-between; align-items:center;">
                            <span class="time">${e.time}</span>
                            ${mapBtn}
                        </div>
                        <div class="evt-title">${e.title}</div>
                        <div class="evt-desc">${e.desc}</div>
                    </div>
                </div>`;
            });
        }
        list += '</div>';
        cont.innerHTML = tabs + list;
    }

    function renderChecklist(cont) {
        document.getElementById('subtitle').innerText = 'ì¤€ë¹„ë¬¼ ì²´í¬ë¦¬ìŠ¤íŠ¸';
        let html = '<div class="card"><div class="card-title">ğŸ‘œ ì§ì‹¸ê¸°</div>';
        (TRIP_DATA.checks || []).forEach((c, i) => {
            const isChk = state.checked[i];
            html += `
            <div class="check-item ${isChk?'checked':''}" onclick="toggleCheck(${i})">
                <div class="check-box">${isChk?'âœ”':''}</div>
                <span>${c.text}</span>
            </div>`;
        });
        html += '</div>';
        cont.innerHTML = html;
    }

    function renderInfo(cont) {
        document.getElementById('subtitle').innerText = 'ìœ ìš©í•œ ì •ë³´';
        cont.innerHTML = `
        <div class="card">
            <div class="card-title">ğŸ†˜ ê¸´ê¸‰ ì—°ë½ì²˜</div>
            <div class="check-item" onclick="location.href='tel:110'">ğŸ‘®â€â™‚ï¸ ê²½ì°°ì„œ (110)</div>
            <div class="check-item" onclick="location.href='tel:119'">ğŸš‘ êµ¬ê¸‰ì°¨ (119)</div>
        </div>
        <div class="card">
            <div class="card-title">ğŸ”— ë¹ ë¥¸ ë§í¬</div>
            <div class="check-item" onclick="window.open('https://translate.google.com')">ğŸ—£ï¸ êµ¬ê¸€ ë²ˆì—­ê¸°</div>
            <div class="check-item" onclick="window.open('https://www.google.com/maps')">ğŸ—ºï¸ êµ¬ê¸€ ì§€ë„</div>
        </div>`;
    }

    // Actions
    window.setTab = (t) => { state.tab = t; render(); window.scrollTo(0,0); };
    window.setDay = (i) => { state.dayIdx = i; render(); };
    window.setMode = (m) => { state.mode = m; render(); window.scrollTo(0,0); };
    window.openMap = (q) => window.open('https://www.google.com/maps/search/?api=1&query='+encodeURIComponent(q));
    window.toggleCheck = (i) => {
        state.checked[i] = !state.checked[i];
        localStorage.setItem('chk_' + TRIP_DATA.title, JSON.stringify(state.checked));
        render();
    };

    // Scroll
    document.getElementById('main-scroll').addEventListener('scroll', function() {
        if(this.scrollTop > 20) document.getElementById('header').classList.add('shrink');
        else document.getElementById('header').classList.remove('shrink');
    });

    init();
</script>
</body>
</html>